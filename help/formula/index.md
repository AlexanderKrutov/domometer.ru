---
title: DomoMeter / Справка / Расчёт услуг по формуле
description: Справка по приложению DomoMeter — «Расчёт услуг по формуле»
topic: help
video: formula
---

<div class="row">
	<ol class="breadcrumb pull-right">
	  <li><a href="{{ '/' | absolute_url }}">DomoMeter</a></li>
	  <li><a href="{{ '/help' | absolute_url }}">Справка</a></li>
	  <li class="active">Расчёт услуг по формуле</li>
	</ol>
</div>

{% include _video.md %}

<div class="instruction" markdown="1">

# Расчёт услуг по формуле

В DomoMeter предусмотрена возможность указать формулу для расчёта стоимости услуги.
Это пригодится, когда услуга начисляется по сложным правилам, не входящим в основной набор [способов расчёта](/help/services/#tarification-type), предустановленных в программе.

Чтобы воспользоваться этим функционалом, нужно при [создании услуги](/help/services/) указать способ расчёта &laquo;Формула&raquo;, и в соответствующем поле ввести формулу, по которой будет производиться расчёт стоимости.
Формула, указанная в свойствах услуги, действует как шаблон: при добавлении новой записи в [Журнал](/help/journal/) будет создана копия формулы, которую можно отредактировать только для выбранного месяца.

## Теги
В формулах можно использовать теги &mdash; специальные строковые маркеры, которые будут заменены на значения расхода или стоимости других счётчиков или услуг.
Набор доступных тегов зависит от созданных счётчиков и услуг и способов их расчёта. 
Для счётчиков и услуг, имеющих расход (например тех, которые рассчитываются по нормативу), доступны теги вида <code>{_название_&nbsp;:&nbsp;расход}</code>. 
Для прочих счётчиков и услуг доступен только тег вида <code>{_название_&nbsp;:&nbsp;сумма}</code>.

Ниже приведён пример формулы для расчёта стоимости услуги, зависящей от суммарного расхода холодной воды по двум счётчикам с названиями _ХВС1_ и _ХВС2_.
Для услуги установлен фиксированный тариф 1.17 руб./м<sup>3</sup>.

<div class="panel panel-default">
<div class="panel-heading">Пример 1. Использование тегов.</div>
<div class="panel-body" markdown="1">
**Формула**
  
<code>({ХВС1&nbsp;:&nbsp;расход}&nbsp;+&nbsp;{ХВС2&nbsp;:&nbsp;расход})&nbsp;*&nbsp;1.17</code>
</div>
</div>

Чтобы добавить тег в формулу, введите текст тега во вкладке &laquo;Формула&raquo; редактора формул, или выберите тег из списка с помощью меню &laquo;Вставить тег или переменную&raquo; на панели инструментов.

## Переменные
Помимо тегов в формулах можно использовать переменные &mdash; специальные строковые маркеры, которые будут заменены на значения, специфичные для каждого месяца.
Например, некоторая услуга может рассчитываться как процент от суммы начислений по холодной воде.
Процент от суммы меняется от месяца к месяцу, и в данном случае можно завести переменную <code>{Процент&nbsp;от&nbsp;суммы}</code>.

<div class="panel panel-default">
<div class="panel-heading">Пример 2. Использование переменных.</div>
<div class="panel-body" markdown="1">
**Формула**
  
<code>({ХВС1&nbsp;:&nbsp;сумма} + {ХВС2&nbsp;:&nbsp;сумма})&nbsp;*&nbsp;{Процент&nbsp;от&nbsp;суммы}&nbsp;/&nbsp;100</code>

**Переменные**

`{Процент&nbsp;от&nbsp;суммы}`

</div>
</div>

Для добавления переменной откройте окно редактора формул, перейдите на вкладку &laquo;Переменные&raquo;, нажмите &laquo;Плюс&raquo; и укажите имя переменной. 
Имя будет использоваться в формуле и отображаться в [Журнале](/help/readings) в параметрах услуги.
Кроме имени переменной нужно указать значение по умолчанию, которое будет использовано при вычислении формулы, если значение переменной не было задано.
Чтобы добавить переменную в формулу, введите текст <code>{*имя_переменной*}</code> во вкладке &laquo;Формула&raquo; редактора формул, или выберите переменную из списка с помощью меню &laquo;Вставить тег или переменную&raquo; на панели инструментов.

Чтобы ввести значение переменной, откройте месяц в Журнале и разверните услугу. В параметрах услуги ниже поля &laquo;Формула&raquo; будет отображён список всех переменных формулы. По нажатию на имя переменной откроется поле для ввода значения.

## Операторы и функции

Ниже дан список операторов или функций, которые можно использовать в формулах.

| Операторы                                | Действие         | Пример                                        | Результат | 
| ---------------------------------------- | ---------------- | --------------------------------------------- | --------- |
| *Арифметические* ||
| `+`                                      | сложение         | `12 + 13`                                     | `25`      |
| `&minus;`                                | вычитание        | `1234 &minus; 234`                            | `1000`    |
| `&#42;`                                  | умножение        | <code>3.23 \* 12</code>                       | `38.76`   |
| <code>/</code>                           | деление          | `63.7 / 2.45`                                 | `26`      |
| *Логические* ||
| <code>=</code>                           | равно            | <code>12 = 3</code>                           | _ложно_   |
| <code>!=</code>                          | не равно         | <code>12 != 3</code>                          | _истинно_ |
| <code>&gt;</code>                        | больше           | <code>12 &gt; 3</code>                        | _истинно_ |
| <code>&lt;</code>                        | меньше           | <code>12 &lt; 3</code>                        | _ложно_   |
| <code>&gt;=</code>                       | больше или равно | <code>12 &gt;= 3</code>                       | _истинно_ |
| <code>&lt;=</code>                       | меньше или равно | <code>12 &lt;= 3</code>                       | _ложно_   |
| <code>&amp;</code>                       | и                | <code>(12 &gt; 3) & (7 &gt; 11)</code>        | _ложно_   |
| <code>\&#124;</code>                     | или              | <code>(1 &gt; 3) \&#124; (7 &lt; 11)</code>   | _истинно_ |
| *Условные* ||
| <code>if (_условие_, _да_, _нет_)</code> | оператор условия | <code>if (12 &gt; 3, 11 \* 2, 44 \* 3)</code> | `22`      |

Для указания явного приоритета вычислений допустимо использование открывающей `(` и закрывающей `)` скобок.

## Оператор условия

Иногда услуга может вычисляться по-разному в зависимости от условий, например, некоторого порогового значения. 
В этих случаях в формулах стоит использовать _оператор условия_.
Оператор условия принимает 3 аргумента: 
* логическое условие (выражение, содержащее логические операторы)
* выражение, которое будет вычислено, если логическое условие выполняется (истинно)
* выражение, которое будет вычислено, если логическое условие не выполняется (ложно)

В таблице выше результатом выполнения функции будет `22`, так как логическое условие <code>12 &gt; 3</code> _истинно_, и будет вычислено первое выражение `11 * 2`.

Ниже дан пример использования формулы для вычисления стоимости услуги, которая зависит от суммарного потребления холодной воды по двум счётчикам.
Если объём потреблённой воды ниже порогового значения, то используется первая тарифная ставка, если выше &mdash; вторая тарифная ставка.
Обратите внимание, что пороговое значение и тарифные ставки введены как переменные, что позволяет использовать одну и ту же формулу при меняющихся тарифах.

<div class="panel panel-default">
<div class="panel-heading">Пример 3. Использование условного оператора.</div>
<div class="panel-body" markdown="1">

**Формула**

<code>if ({ХВС1 : расход} + {ХВС2 : расход} &lt; {Порог}, {Ставка 1}, {Ставка 2}) * ({ХВС1 : расход} + {ХВС2 : расход})</code>

**Переменные**

`{Порог}`  
`{Ставка 1}`  
`{Ставка 2}`  

</div>
</div>

Таким образом, использование формул в программе DomoMeter позволяет реализовать самые сложные варианты начисления стоимости коммунальных услуг.

</div>